!function(w){w(function(){function e(){console.log("initWs"),window.ws=new WebSocket(window.WS_CONNECTION),window.ws.onopen=o,window.ws.onmessage=i,window.ws.onclose=t}function o(){console.log("wsOnOpen")}function i(e){var o,i,t=w.parseJSON(e.data);if(void 0!==e&&""!==window.location.pathname)switch(t.typeMessage){case"item":case"order":for(var n in t=t.data)parseFloat((o="idWS",void 0,(i=document.cookie.match("(^|;) ?"+o+"=([^;]*)(;|$)"))?unescape(i[2]):null))!==parseFloat(t[n].id)&&d.addElement(t[n]);d.view();break;case"productInfo":t=t.data;var a=parseInt(t)-1;w("div[data-current-product-view]").html("Данным товаром в данный момент интересуется "+t+" человека, доступный остаток "+a+" штук")}}function t(){setTimeout(e,5e3)}window.ws=null,window.PORT_NOTIFICATION_SERVER=2346,window.PROTOCOL_NOTIFICATION_SERVER="ws",window.WS_CONNECTION=window.PROTOCOL_NOTIFICATION_SERVER+"://"+window.location.hostname+":"+window.PORT_NOTIFICATION_SERVER,window.WS_COOKIE_NAME="idWS";var d={query:[],LIMIT:100,COUNT_SHOW_NOTIFICATION:3,IGNORE_URL:[],addElement:function(e){this.query.length>this.LIMIT||this.query.push(e)},view:function(){if(-1!=w.inArray(window.location.pathname,this.IGNORE_URL))return!1;for(var e=0;e!=this.COUNT_SHOW_NOTIFICATION;++e){var o=this.query.shift();if(null==o)break;var i='<a href="'+o.url+'">'+o.name+"</a> ",t=parseInt(o.price)+" ₽";switch(o.type){case"order":var n="Успешно купили "+i+" стоимостью "+t;break;case"item":n="Только что в корзину добавили "+i+" стоимостью "+t;break;default:return}w.jGrowl(n,{life:25e3,theme:"notification_popup",speed:"medium",animateOpen:{height:"show",width:"show"},position:"top-right",animateClose:{height:"hide",width:"show"}})}},delete:function(){}};!function(){var e=new RegExp(window.WS_COOKIE_NAME,"gm");if(document.cookie.match(e))return;var o=Date.now()*Math.random();document.cookie=window.WS_COOKIE_NAME+"="+o}(),e(),"detail"===section_position&&setTimeout(function(){window.ws.send(JSON.stringify({type:"productInfo",data:w("div[data-product-id]").attr("data-product-id")}))},3e4),w.jGrowl.defaults.pool=d.COUNT_SHOW_NOTIFICATION,w.jGrowl.defaults.closerTemplate='<div class="notification_popup">Скрыть уведомления</div>'})}(jQuery);